"use strict";const scrollDelay=1500,options={container:"#ps-pages",pageSelector:".ps-page",direction:"vertical",menu:null,anchors:[],scrollingSpeed:700,touchSensitivity:5,loopBottom:!1,loopTop:!1,keyboardScrolling:!0,hashHistorial:!1,beforeSlide:null,afterSlide:null},isTouch="ontouchstart"in window||"msMaxTouchPoints"in navigator&&navigator.msMaxTouchPoints>0||navigator.maxTouchPoints,coord={touchStartY:0,touchStartX:0,touchEndY:0,touchEndX:0};let lastScrolledDestiny,$container,$pages,$firstPage,$lastPage,$navbar,$listItems,$navAnchors,scrollings=[],lastAnimation=0,prevTime=(new Date).getTime();const defineConfig=e=>{Object.assign(options,e),options.navigation=Object.assign({dynamic:!1,position:"right",container:"#ps-nav",class:[],tooltips:[]},e.navigation)},setAllowScrolling=e=>{setMouseWheelScrolling(e),e?addTouchHandler():removeTouchHandler()},setScrollingSpeed=e=>options.scrollingSpeed=e,setKeyboardScrolling=e=>options.keyboardScrolling=e,setMouseWheelScrolling=e=>e?addMouseWheelHandler():removeMouseWheelHandler(),moveToPrevPage=()=>{const e=$pages.find((e=>e.classList.contains("active")));let n=$pages[$pages.indexOf(e)-1];!n&&options.loopTop&&(n=$lastPage),n&&scrollPage(n)},moveToNextPage=()=>{const e=$pages.find((e=>e.classList.contains("active")));let n=$pages[$pages.indexOf(e)+1];!n&&options.loopBottom&&(n=$firstPage),n&&scrollPage(n)},moveTo=e=>{const n="number"!=typeof e?e:$pages[e-1];n&&scrollPage(n)},init=()=>{$container=document.querySelector(options.container),$pages=Array.from($container.querySelectorAll(options.pageSelector)),$firstPage=$pages[0],$lastPage=$pages[$pages.length-1],$navbar=document.querySelector(options.navigation.container),$listItems=Array.from($navbar.querySelectorAll("li, [anchor]")),$navAnchors=$listItems.map((e=>e.querySelector("a"))),new Promise((e=>{const n=$pages.find((e=>e.classList.contains("active")));for(let e=0,o=$pages.length,t=$pages.length;e<t;e++,o--){const t=$pages[e];t.style.zIndex=o.toString(),e||n||t.classList.add("active")}return e()})).then((()=>{if($navbar){const e=$pages.findIndex((e=>e.classList.contains("active")));$listItems[e].querySelector("a").classList.add("active")}})).catch(console.error),setAllowScrolling(!0),options.hashHistorial&&(window.addEventListener("load",(()=>scrollToAnchor())),window.addEventListener("hashchange",hashChangeHandler)),options.navigation.dynamic&&addNavigationBar(),options.keyboardScrolling&&keyboardNavigation(),document.addEventListener("click",delegatedClickEvents),document.addEventListener("touchstart",delegatedClickEvents)},delegatedClickEvents=e=>{const n=e.target,o=n.closest(`${options.navigation?.container} li,\n                                    ${options.navigation?.container} [anchor]`);if(o){const e=o,n=Array.from(e.parentElement.children).findIndex((n=>n===e));scrollPage($pages[n])}if(options.menu&&n.matches(`${options.menu} [data-anchor]`)||n.closest(`${options.menu} [data-anchor]`)){e.stopPropagation();const o=n.closest("[data-anchor]")?.dataset.anchor;scrollToAnchor(o)}},keyboardNavigation=()=>{window.addEventListener("keydown",(e=>{const n=$pages.find((e=>e.classList.contains("active")));!isPageTransitionRunning()&&e.target.matches("body")&&(38===e.keyCode||33===e.keyCode||37===e.keyCode?isScrolled("top",n)&&moveToPrevPage():40===e.keyCode||34===e.keyCode||39===e.keyCode?isScrolled("bottom",n)&&moveToNextPage():36===e.keyCode?moveTo($firstPage):35===e.keyCode&&moveTo($lastPage))}))};function addNavigationBar(){const e=document.createElement("section"),n=document.createElement("ul");e.id=options.navigation.container.replace(/^\.|#/,""),e.classList.add(options.navigation.position),options.navigation.class.length&&e.classList.add(...options.navigation.class);for(let e=0;e<$pages.length;e++){let o,t;const a=document.createElement("li");options.anchors.length&&(o=options.anchors[e]),options.navigation.tooltips.length&&(t=void 0===options.navigation.tooltips[e]?"":options.navigation.tooltips[e]),t&&(a.dataset.tooltip=t),a.insertAdjacentHTML("beforeend",`\n      <a href="#${o}"><span></span></a>\n      ${t?`<section class="ps-tooltip ${options.navigation.position}">${t}</section>`:""}\n    `),n.insertAdjacentElement("beforeend",a)}e.append(n),document.body.insertAdjacentElement("beforeend",e)}function handleNav(e,n){options.navigation&&($navAnchors.find((e=>e.classList.contains("active"))).classList.remove("active"),e?$navAnchors.find((n=>n.href.includes(`#${e}`))).classList.add("active"):$navAnchors[n].classList.add("active"))}function getMovementDirection(e){return $pages.findIndex((e=>e.classList.contains("active")))>$pages.findIndex((n=>n===e))?"prev":"next"}function transformContainer(e,n,o){e.classList["next"===o?"add":"remove"](n)}function performMovement(e){transformContainer(e.animatePage,e.translationClass,e.movementDirection),e.pagesToMove.forEach((n=>transformContainer(n,e.translationClass,e.movementDirection))),setTimeout((()=>afterPageChange(e)),options.scrollingSpeed)}function getPagesToMove(e){let n;return n="next"===e.movementDirection?$pages.filter(((n,o)=>o<$pages.findIndex((n=>n===e.destinyPage))&&n)):$pages.filter(((n,o)=>o>$pages.findIndex((n=>n===e.destinyPage))&&n)),n}function getDirection(e){switch(e){case"left":case"horizontal":return"left";case"right":case"horizontal-inverted":return"right";case"down":case"bottom":case"vertical-inverted":return"down";case"up":case"top":case"vertical":default:return"up"}}function scrollPage(e){const n={activePage:$pages.find((e=>e.classList.contains("active"))),activePageIndex:$pages.findIndex((e=>e.classList.contains("active")))+1,destinyPage:e,destinyPageIndex:$pages.findIndex((n=>n===e)),destinyAnchor:e.id,movementDirection:getMovementDirection(e)};if(n.activePage===e)return;options.hashHistorial&&void 0!==n.destinyAnchor&&setURLHash(n.destinyAnchor),n.activePage.classList.remove("active"),n.destinyPage.classList.add("active"),n.pagesToMove=getPagesToMove(n),n.translationClass=`scrolled-${getDirection(options.direction)}`,n.animatePage="next"===n.movementDirection?n.activePage:e,beforePageChange(n),performMovement(n),(options.navigation||options.navigation.dynamic)&&handleNav(n.destinyAnchor,n.destinyPageIndex);let o=(new Date).getTime();lastScrolledDestiny=n.destinyAnchor,lastAnimation=o}function setURLHash(e){options.anchors.length>0&&(location.hash=e)}function scrollToAnchor(e=null){const n=e||window.location.hash.replace("#",""),o=$pages.find((e=>e.id===n));o&&scrollPage(o)}function isPageTransitionRunning(){return(new Date).getTime()-lastAnimation<1500+options.scrollingSpeed}function isScrolled(e,n){return"top"===e?!n.scrollTop:n.scrollTop+n.offsetHeight+1>n.scrollHeight}function scrolling(e,n){const o="down"===e?moveToNextPage:moveToPrevPage;n?isScrolled("down"==e?"bottom":"top",n)&&o():o()}function isScrollable(e){return e.classList.contains("ps-scrollable")&&e}function beforePageChange(e){options.beforeSlide instanceof Function&&options.beforeSlide(e)}function afterPageChange(e){options.afterSlide instanceof Function&&options.afterSlide(e)}function getAverage(e,n){let o=0,t=e.slice(Math.max(e.length-n,1));for(let e=0;e<t.length;e++)o+=t[e];return Math.ceil(o/n)}function mouseWheelHandler(e){e=e||window.event;const n=(new Date).getTime(),o=n-prevTime;prevTime=n;const t=e.wheelDelta||-e.deltaY||-e.detail,a=Math.max(-1,Math.min(1,t)),i=void 0!==e.wheelDeltaX||void 0!==e.deltaX,s=Math.abs(e.wheelDeltaX)<Math.abs(e.wheelDelta)||Math.abs(e.deltaX)<Math.abs(e.deltaY)||!i;if(scrollings.length>149&&scrollings.shift(),scrollings.push(Math.abs(t)),o>200&&(scrollings=[]),!isPageTransitionRunning()){if(getAverage(scrollings,10)>=getAverage(scrollings,70)&&s){const e=isScrollable($pages.find((e=>e.classList.contains("active"))));a<0?scrolling("down",e):a>0&&scrolling("up",e)}return!1}}function getMSPointer(){return window.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function isReallyTouch(e){return void 0===e.pointerType||"mouse"!=e.pointerType}function getTouchEventCoordinates(e){const n={};return n.y=void 0!==e.pageY&&(e.pageY||e.pageX)?e.pageY:e.touches[0].pageY,n.x=void 0!==e.pageX&&(e.pageY||e.pageX)?e.pageX:e.touches[0].pageX,n}function setTouchCoordinates(e,n){const o=getTouchEventCoordinates(e);coord[`touch${n}Y`]=o.y,coord[`touch${n}X`]=o.x}function touchStartHandler(e){isReallyTouch(e)&&setTouchCoordinates(e,"Start")}function calculateAxisTouchMovement(e,n){const o=coord["touchStart"+("x"===e?"X":"Y")],t=coord["touchEnd"+("x"===e?"X":"Y")],a="x"===e?"Width":"Height";return Math.abs(o-t)>n[`offset${a}`]/100*options.touchSensitivity&&(o>t?"down":t>o&&"up")}function touchMoveHandler(e){if(isReallyTouch(e)){const n=isScrollable($pages.find((e=>e.classList.contains("active"))));if(n||e.preventDefault(),n&&!isPageTransitionRunning()){setTouchCoordinates(e,"End");const o=("left"===getDirection(options.direction)||"right"===getDirection(options.direction))&&Math.abs(coord.touchStartX-coord.touchEndX)>Math.abs(coord.touchStartY-coord.touchEndY)?calculateAxisTouchMovement("x",n):calculateAxisTouchMovement("y",n);o&&scrolling(o,n)}}}function addMouseWheelHandler(){"attachEvent"in $container?$container.attachEvent("onmousewheel",mouseWheelHandler):($container.addEventListener("mousewheel",mouseWheelHandler,!1),$container.addEventListener("wheel",mouseWheelHandler,!1))}function removeMouseWheelHandler(){"detachEvent"in $container?$container.detachEvent("onmousewheel",mouseWheelHandler):($container.removeEventListener("mousewheel",mouseWheelHandler,!1),$container.removeEventListener("wheel",mouseWheelHandler,!1))}function addTouchHandler(){if(isTouch){const e=getMSPointer();$container[e.down]=touchStartHandler,$container[e.move]=touchMoveHandler,$container.ontouchstart=touchStartHandler,$container.ontouchmove=touchMoveHandler}}function removeTouchHandler(){if(isTouch){const e=getMSPointer();$container[e.down]=null,$container[e.move]=null,$container.ontouchstart=null,$container.ontouchmove=null}}function hashChangeHandler(){const e=window.location.hash.replace("#","").split("/")[0];if(e&&e!==lastScrolledDestiny){scrollPage("number"!=typeof e?document.getElementById(e):$pages[e-1])}}export{defineConfig,setAllowScrolling,setScrollingSpeed,setKeyboardScrolling,setMouseWheelScrolling,moveToPrevPage,moveToNextPage,moveTo,init};